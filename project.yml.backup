name: bitchat
options:
  bundleIdPrefix: com.cypherbase.bitchat
  developmentLanguage: en
  createIntermediateGroups: true
  deploymentTarget:
    iOS: 16.0
    macOS: 13.0
    watchOS: 9.0
    tvOS: 16.0

packages:
  NoiseC:
    url: https://github.com/zeugmaster/NoiseC
    from: 1.0.4

targets:
  bitchat:
    type: application
    platform: [iOS, macOS]
    attributes:
      ProvisioningStyle: Automatic
    settings:
      base:
        PRODUCT_NAME: bitchat
        MARKETING_VERSION: 1.0
        CURRENT_PROJECT_VERSION: 1
        IPHONEOS_DEPLOYMENT_TARGET: 16.0
        MACOSX_DEPLOYMENT_TARGET: 13.0
        GENERATE_INFOPLIST_FILE: NO
        INFOPLIST_FILE[sdk=iphoneos*]: bitchat/Info-iOS.plist
        INFOPLIST_FILE[sdk=macosx*]: bitchat/Info-macOS.plist
        ENABLE_HARDENED_RUNTIME: YES
        CODE_SIGN_ENTITLEMENTS[sdk=iphoneos*]: bitchat/bitchat.entitlements
        CODE_SIGN_ENTITLEMENTS[sdk=macosx*]: bitchat/bitchat-macOS.entitlements
        SUPPORTS_MACCATALYST: NO
        TARGETED_DEVICE_FAMILY: 1,2
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ASSETCATALOG_COMPILER_GLOBAL_ACCENT_COLOR_NAME: AccentColor
        SWIFT_STRICT_CONCURRENCY: complete
        SWIFT_UPCOMING_FEATURE_CONCISE_MAGIC_FILE: YES
        SWIFT_UPCOMING_FEATURE_FORWARD_TRAILING_CLOSURES: YES
        SWIFT_UPCOMING_FEATURE_BARE_SLASH_REGEX_LITERALS: YES
        SWIFT_UPCOMING_FEATURE_DISABLE_OUTWARD_ACTOR_ISOLATION: YES
        SWIFT_UPCOMING_FEATURE_DEPRECATE_APPLICATION_MAIN: YES
        SWIFT_UPCOMING_FEATURE_ISOLATED_DEFAULT_VALUES: YES
        SWIFT_UPCOMING_FEATURE_GLOBAL_ACTOR_ISOLATED_TYPEALIAS: YES
        CLANG_ANALYZER_LOCALIZABILITY_NONLOCALIZED: YES
    sources:
      - bitchat
    dependencies:
      - package: NoiseC
    scheme:
      environmentVariables:
        OS_ACTIVITY_MODE: disable

  bitchatTests:
    type: bundle.unit-test
    platform: [iOS, macOS]
    sources:
      - bitchatTests
    dependencies:
      - target: bitchat
      - package: NoiseC

  bitchatShareExtension:
    type: app-extension
    platform: [iOS, macOS]
    settings:
      base:
        PRODUCT_NAME: bitchatShareExtension
        MARKETING_VERSION: 1.0
        CURRENT_PROJECT_VERSION: 1
        IPHONEOS_DEPLOYMENT_TARGET: 16.0
        MACOSX_DEPLOYMENT_TARGET: 13.0
        GENERATE_INFOPLIST_FILE: NO
        INFOPLIST_FILE: bitchatShareExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: bitchatShareExtension/bitchatShareExtension.entitlements
        SUPPORTS_MACCATALYST: NO
        TARGETED_DEVICE_FAMILY: 1,2
        SWIFT_STRICT_CONCURRENCY: complete
    sources:
      - bitchatShareExtension
    dependencies:
      - package: NoiseC

schemes:
  "bitchat (macOS)":
    build:
      targets:
        bitchat: [macOS]
    run:
      config: Debug
    test:
      config: Debug
      targets:
        - name: bitchatTests
          parallelizable: false
        
  "bitchat (iOS)":
    build:
      targets:
        bitchat: [iOS]
    run:
      config: Debug
    test:
      config: Debug
      targets:
        - name: bitchatTests
          parallelizable: false
